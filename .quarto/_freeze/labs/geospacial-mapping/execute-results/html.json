{
  "hash": "c11ba0f400331fe27ee532f700005b03",
  "result": {
    "engine": "knitr",
    "markdown": "\n# Geospacial Mapping: POP? SODA? or COKE?\n\n\nIn 2013 a statistics (!) grad student at NC State named Joshua Katz put up a series of maps on an R Studio server that plotted the geographic distributions of lexical variants across the US. These turned out to be wildly popular and he published versions at Business Insider:\n\n<https://www.businessinsider.com/american-english-dialects-maps-2018-1>\n\nAnd at the New York Times, where he now works:\n\n<https://www.nytimes.com/interactive/2014/upshot/dialect-quiz-map.html>\n\nHis maps are based on data collect by Bert Vaux and Scott Golder for the Harvard Dialect Survey in 2003:\n\n<http://www4.uwm.edu/FLL/linguistics/dialect/index.html>\n\nKatz's work is an interesting application of KNN to geospatial data. There is a nice introduction to the KNN algorithm here:\n\n<https://www.analyticsvidhya.com/blog/2018/03/introduction-k-neighbours-algorithm-clustering/>\n\nWe're going to re-create Katz's pop vs. soda plot. This exercise requires a number of packages.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# A couple for data wrangling...\nlibrary(tidyverse)\nlibrary(data.table)\nlibrary(gt)\n\n# Our plots will be based on the results of knn...\nlibrary(kknn) # for knn\n\n# We have some relatively intensive processing tasks that can be sped up... \nlibrary(foreach) # for iterating over elements in a collection\nlibrary(doParallel) # for parallel processing\n\n# And we'll be working with spatial data, so we need some specialized packages...\nlibrary(sf) # for spatial data\nlibrary(rnaturalearth) # map data for plotting\nlibrary(housingData) # geolocation data\nrequire(rgeos)\n```\n:::\n\n\n## Prepare the Data\n\n### Load the pop vs. soda data\n\nRead in the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npvs_df <- read_csv(\"../data/pop_vs_soda.csv\", show_col_types = F)\n```\n:::\n\n\nNote how the data is structures.\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"sckkjvijee\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#sckkjvijee table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#sckkjvijee thead, #sckkjvijee tbody, #sckkjvijee tfoot, #sckkjvijee tr, #sckkjvijee td, #sckkjvijee th {\n  border-style: none;\n}\n\n#sckkjvijee p {\n  margin: 0;\n  padding: 0;\n}\n\n#sckkjvijee .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#sckkjvijee .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#sckkjvijee .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#sckkjvijee .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#sckkjvijee .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#sckkjvijee .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#sckkjvijee .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#sckkjvijee .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#sckkjvijee .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#sckkjvijee .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#sckkjvijee .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#sckkjvijee .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#sckkjvijee .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#sckkjvijee .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#sckkjvijee .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sckkjvijee .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#sckkjvijee .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#sckkjvijee .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#sckkjvijee .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sckkjvijee .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#sckkjvijee .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sckkjvijee .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#sckkjvijee .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sckkjvijee .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#sckkjvijee .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#sckkjvijee .gt_left {\n  text-align: left;\n}\n\n#sckkjvijee .gt_center {\n  text-align: center;\n}\n\n#sckkjvijee .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#sckkjvijee .gt_font_normal {\n  font-weight: normal;\n}\n\n#sckkjvijee .gt_font_bold {\n  font-weight: bold;\n}\n\n#sckkjvijee .gt_font_italic {\n  font-style: italic;\n}\n\n#sckkjvijee .gt_super {\n  font-size: 65%;\n}\n\n#sckkjvijee .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#sckkjvijee .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#sckkjvijee .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#sckkjvijee .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#sckkjvijee .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#sckkjvijee .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#sckkjvijee .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#sckkjvijee .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#sckkjvijee div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"State\">State</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"County_Name\">County_Name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"FIPS_State\">FIPS_State</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"FIPS_County\">FIPS_County</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"FIPS_combo\">FIPS_combo</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"id\">id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ID1_GADM\">ID1_GADM</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"NAME_ST\">NAME_ST</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"ID2_GADM\">ID2_GADM</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"NAME_COU\">NAME_COU</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SUMCOUNT\">SUMCOUNT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SUMPOP\">SUMPOP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SUMSODA\">SUMSODA</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SUMCOKE\">SUMCOKE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SUMOTHER\">SUMOTHER</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"COUNT\">COUNT</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"PCTPOP\">PCTPOP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"PCTSODA\">PCTSODA</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"PCTCOKE\">PCTCOKE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"PCTOTHER\">PCTOTHER</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Autauga</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">001</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1001</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Autauga</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">19</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">5</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">13</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">1</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">4</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.26316</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.68421</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.05263</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Baldwin</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">003</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01003</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1003</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">2</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Baldwin</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">78</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">5</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">70</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">2</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">12</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.01282</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.06410</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.89744</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.02564</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Barbour</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">005</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01005</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1005</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">3</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Barbour</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">18</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">3</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">14</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">1</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">3</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.16667</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.77778</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.05556</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Bibb</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">007</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01007</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1007</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">4</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Bibb</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">8</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">4</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.11111</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.88889</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.00000</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Blount</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">009</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01009</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1009</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">5</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Blount</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">16</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">13</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">1</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">3</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.12500</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.81250</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.06250</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Bullock</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">011</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01011</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1011</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">6</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Bullock</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">10</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">1</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.90000</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.10000</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.00000</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Butler</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">013</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01013</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1013</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">7</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Butler</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">7</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">1</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.22222</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.77778</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.00000</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Calhoun</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">015</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01015</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1015</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">8</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Calhoun</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">85</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">1</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">18</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">62</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">4</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">12</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.01176</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.21176</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.72941</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.04706</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Chambers</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">017</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01017</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1017</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">9</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Chambers</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">11</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">2</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">4</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.18182</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">0.81818</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.00000</td></tr>\n    <tr><td headers=\"State\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"County_Name\" class=\"gt_row gt_left\">Cherokee</td>\n<td headers=\"FIPS_State\" class=\"gt_row gt_right\">01</td>\n<td headers=\"FIPS_County\" class=\"gt_row gt_right\">019</td>\n<td headers=\"FIPS_combo\" class=\"gt_row gt_right\">01019</td>\n<td headers=\"id\" class=\"gt_row gt_right\">1019</td>\n<td headers=\"ID1_GADM\" class=\"gt_row gt_right\">1</td>\n<td headers=\"NAME_ST\" class=\"gt_row gt_left\">Alabama</td>\n<td headers=\"ID2_GADM\" class=\"gt_row gt_right\">10</td>\n<td headers=\"NAME_COU\" class=\"gt_row gt_left\">Cherokee</td>\n<td headers=\"SUMCOUNT\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMPOP\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMSODA\" class=\"gt_row gt_right\">0</td>\n<td headers=\"SUMCOKE\" class=\"gt_row gt_right\">9</td>\n<td headers=\"SUMOTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"COUNT\" class=\"gt_row gt_right\">3</td>\n<td headers=\"PCTPOP\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTSODA\" class=\"gt_row gt_right\">0.00000</td>\n<td headers=\"PCTCOKE\" class=\"gt_row gt_right\">1.00000</td>\n<td headers=\"PCTOTHER\" class=\"gt_row gt_right\">0.00000</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n### Convert FIPS codes to longitude and latitude\n\nWe have counts by state and county. Importantly, those counts are identified by Federal Information Processing System (FIPS) codes. To convert that information to something map-able, we need GIS data for those FIPS codes. For that we can use data from the **housingData** package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhd <- housingData::geoCounty\nhd$fips <- as.character(hd$fips)\n```\n:::\n\n\nNow let's select the columns we need from our data, and put that data in a long format.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npvs_df <- pvs_df %>% select(fips = FIPS_combo, POP = SUMPOP, SODA = SUMSODA, \n                       COKE = SUMCOKE, OTHER = SUMOTHER)\n\npvs_df <- pvs_df %>% \n  pivot_longer(!fips, names_to = \"var\", values_to = \"freq\") %>% \n  filter(freq != 0) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npvs_df |>\n  head(10) |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"qzsitjybtr\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#qzsitjybtr table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#qzsitjybtr thead, #qzsitjybtr tbody, #qzsitjybtr tfoot, #qzsitjybtr tr, #qzsitjybtr td, #qzsitjybtr th {\n  border-style: none;\n}\n\n#qzsitjybtr p {\n  margin: 0;\n  padding: 0;\n}\n\n#qzsitjybtr .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#qzsitjybtr .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#qzsitjybtr .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#qzsitjybtr .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#qzsitjybtr .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#qzsitjybtr .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#qzsitjybtr .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#qzsitjybtr .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#qzsitjybtr .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#qzsitjybtr .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#qzsitjybtr .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#qzsitjybtr .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#qzsitjybtr .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#qzsitjybtr .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#qzsitjybtr .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qzsitjybtr .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#qzsitjybtr .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#qzsitjybtr .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#qzsitjybtr .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qzsitjybtr .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#qzsitjybtr .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qzsitjybtr .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#qzsitjybtr .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qzsitjybtr .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#qzsitjybtr .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#qzsitjybtr .gt_left {\n  text-align: left;\n}\n\n#qzsitjybtr .gt_center {\n  text-align: center;\n}\n\n#qzsitjybtr .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#qzsitjybtr .gt_font_normal {\n  font-weight: normal;\n}\n\n#qzsitjybtr .gt_font_bold {\n  font-weight: bold;\n}\n\n#qzsitjybtr .gt_font_italic {\n  font-style: italic;\n}\n\n#qzsitjybtr .gt_super {\n  font-size: 65%;\n}\n\n#qzsitjybtr .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#qzsitjybtr .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#qzsitjybtr .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#qzsitjybtr .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#qzsitjybtr .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#qzsitjybtr .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#qzsitjybtr .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#qzsitjybtr .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#qzsitjybtr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"fips\">fips</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"var\">var</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"freq\">freq</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">5</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">13</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">OTHER</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01003</td>\n<td headers=\"var\" class=\"gt_row gt_left\">POP</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01003</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">5</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01003</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">70</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01003</td>\n<td headers=\"var\" class=\"gt_row gt_left\">OTHER</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">2</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01005</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">3</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01005</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">14</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01005</td>\n<td headers=\"var\" class=\"gt_row gt_left\">OTHER</td>\n<td headers=\"freq\" class=\"gt_row gt_right\">1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nFor the task, we need to convert counts into instances. For example, if there are 3 *soda* users in a county, we want:\n\n*soda*, *soda*, *soda* in the variable column. For that, we can use the data.table package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetDT(pvs_df)\npvs_df <- pvs_df[rep(seq(.N), freq), !\"freq\"]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npvs_df |>\n  head(10) |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"upvpprlogk\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#upvpprlogk table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#upvpprlogk thead, #upvpprlogk tbody, #upvpprlogk tfoot, #upvpprlogk tr, #upvpprlogk td, #upvpprlogk th {\n  border-style: none;\n}\n\n#upvpprlogk p {\n  margin: 0;\n  padding: 0;\n}\n\n#upvpprlogk .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#upvpprlogk .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#upvpprlogk .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#upvpprlogk .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#upvpprlogk .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#upvpprlogk .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#upvpprlogk .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#upvpprlogk .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#upvpprlogk .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#upvpprlogk .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#upvpprlogk .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#upvpprlogk .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#upvpprlogk .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#upvpprlogk .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#upvpprlogk .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upvpprlogk .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#upvpprlogk .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#upvpprlogk .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#upvpprlogk .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upvpprlogk .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#upvpprlogk .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upvpprlogk .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#upvpprlogk .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upvpprlogk .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#upvpprlogk .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#upvpprlogk .gt_left {\n  text-align: left;\n}\n\n#upvpprlogk .gt_center {\n  text-align: center;\n}\n\n#upvpprlogk .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#upvpprlogk .gt_font_normal {\n  font-weight: normal;\n}\n\n#upvpprlogk .gt_font_bold {\n  font-weight: bold;\n}\n\n#upvpprlogk .gt_font_italic {\n  font-style: italic;\n}\n\n#upvpprlogk .gt_super {\n  font-size: 65%;\n}\n\n#upvpprlogk .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#upvpprlogk .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#upvpprlogk .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#upvpprlogk .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#upvpprlogk .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#upvpprlogk .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#upvpprlogk .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#upvpprlogk .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#upvpprlogk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"fips\">fips</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"var\">var</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nNow let's join this with the GIS data to add longitudes and latitudes, and drop any empty rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npvs_df <- left_join(pvs_df, select(hd, fips, lon, lat), by = \"fips\")\npvs_df <- pvs_df[!is.na(pvs_df$lon), ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\npvs_df |>\n  head(10) |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ufidcdvxvp\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ufidcdvxvp table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ufidcdvxvp thead, #ufidcdvxvp tbody, #ufidcdvxvp tfoot, #ufidcdvxvp tr, #ufidcdvxvp td, #ufidcdvxvp th {\n  border-style: none;\n}\n\n#ufidcdvxvp p {\n  margin: 0;\n  padding: 0;\n}\n\n#ufidcdvxvp .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ufidcdvxvp .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ufidcdvxvp .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ufidcdvxvp .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ufidcdvxvp .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ufidcdvxvp .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ufidcdvxvp .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ufidcdvxvp .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ufidcdvxvp .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ufidcdvxvp .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ufidcdvxvp .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ufidcdvxvp .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ufidcdvxvp .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ufidcdvxvp .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ufidcdvxvp .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ufidcdvxvp .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ufidcdvxvp .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ufidcdvxvp .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ufidcdvxvp .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ufidcdvxvp .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ufidcdvxvp .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ufidcdvxvp .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ufidcdvxvp .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ufidcdvxvp .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ufidcdvxvp .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ufidcdvxvp .gt_left {\n  text-align: left;\n}\n\n#ufidcdvxvp .gt_center {\n  text-align: center;\n}\n\n#ufidcdvxvp .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ufidcdvxvp .gt_font_normal {\n  font-weight: normal;\n}\n\n#ufidcdvxvp .gt_font_bold {\n  font-weight: bold;\n}\n\n#ufidcdvxvp .gt_font_italic {\n  font-style: italic;\n}\n\n#ufidcdvxvp .gt_super {\n  font-size: 65%;\n}\n\n#ufidcdvxvp .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ufidcdvxvp .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ufidcdvxvp .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ufidcdvxvp .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ufidcdvxvp .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ufidcdvxvp .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ufidcdvxvp .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ufidcdvxvp .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ufidcdvxvp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"fips\">fips</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"var\">var</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"lon\">lon</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"lat\">lat</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n    <tr><td headers=\"fips\" class=\"gt_row gt_right\">01001</td>\n<td headers=\"var\" class=\"gt_row gt_left\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">-86.64565</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">32.54009</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n### Prepare a map\n\nNow let's get the information we need for our map. We'll start with a map of the US states.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_us <- rnaturalearthdata::states50\n```\n:::\n\n\nThere are several map options. We're going to select *iso_a2*. We'll also drop Alaska and Hawaii, so we'll only plot the Continental US.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_us <- states_us[states_us$iso_a2 == 'US',]\nstates_us <- states_us[ !grepl( \"Alaska|Hawaii\" , states_us$name ) , ]\n```\n:::\n\n\nFinally we want to convert this into an sf object for later plotting. This creates a *simple features* object. For more about *simple features* see here:\n\n<https://r-spatial.github.io/sf/articles/sf1.html>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstates_us <- st_as_sf(states_us)\n```\n:::\n\n\n### Transform the data for plotting\n\nNow we'll similarly convert the coordinates in our pop vs. soda data. Note that we point the *st_as_sf()* function to our \"lon\" and \"lat\" columns. Additionally, we need to specify the coordinate reference system (crs). This can be tricky... See here for a discussion:\n\n<https://ryanpeek.github.io/2017-08-03-converting-XY-data-with-sf-package/>\n\nWe're specifying The World Geodetic System 1984 or WGS84.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npoint_data <- pvs_df %>% st_as_sf(coords = c(\"lon\", \"lat\"), crs = \"+proj=longlat +ellps=WGS84\")\n```\n:::\n\n\nFinally, we need to specify a projection. Remember we are \"projecting\" geographical space into 2 dimensions. So we have to decide what convention to use. We'll use the North America Lambert Conformal Conic projection:\n\n<https://en.wikipedia.org/wiki/Lambert_conformal_conic_projection>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnalcc <- \"+proj=lcc +lat_1=20 +lat_2=60 +lat_0=40 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs\"\n```\n:::\n\n\nNow, we can transform our US data to fit this projection. And likewise our pop vs. soda data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nus <- states_us %>% st_transform(nalcc)\npoint_data <- point_data %>% st_transform(nalcc)\n```\n:::\n\n\nNext, we'll make a data.frame with 3 columns. And we'll convert our variable to a factor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_train <- data.frame(dialect = point_data$var, \n                             lon = st_coordinates(point_data)[, 1], \n                             lat = st_coordinates(point_data)[, 2]) %>%\n  mutate(dialect = as.factor(dialect))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ndialects_train |>\n  head(10) |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"carxtvwswl\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#carxtvwswl table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#carxtvwswl thead, #carxtvwswl tbody, #carxtvwswl tfoot, #carxtvwswl tr, #carxtvwswl td, #carxtvwswl th {\n  border-style: none;\n}\n\n#carxtvwswl p {\n  margin: 0;\n  padding: 0;\n}\n\n#carxtvwswl .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#carxtvwswl .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#carxtvwswl .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#carxtvwswl .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#carxtvwswl .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#carxtvwswl .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#carxtvwswl .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#carxtvwswl .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#carxtvwswl .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#carxtvwswl .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#carxtvwswl .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#carxtvwswl .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#carxtvwswl .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#carxtvwswl .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#carxtvwswl .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#carxtvwswl .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#carxtvwswl .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#carxtvwswl .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#carxtvwswl .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#carxtvwswl .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#carxtvwswl .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#carxtvwswl .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#carxtvwswl .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#carxtvwswl .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#carxtvwswl .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#carxtvwswl .gt_left {\n  text-align: left;\n}\n\n#carxtvwswl .gt_center {\n  text-align: center;\n}\n\n#carxtvwswl .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#carxtvwswl .gt_font_normal {\n  font-weight: normal;\n}\n\n#carxtvwswl .gt_font_bold {\n  font-weight: bold;\n}\n\n#carxtvwswl .gt_font_italic {\n  font-style: italic;\n}\n\n#carxtvwswl .gt_super {\n  font-size: 65%;\n}\n\n#carxtvwswl .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#carxtvwswl .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#carxtvwswl .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#carxtvwswl .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#carxtvwswl .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#carxtvwswl .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#carxtvwswl .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#carxtvwswl .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#carxtvwswl div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dialect\">dialect</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"lon\">lon</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"lat\">lat</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">SODA</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n    <tr><td headers=\"dialect\" class=\"gt_row gt_center\">COKE</td>\n<td headers=\"lon\" class=\"gt_row gt_right\">832585.8</td>\n<td headers=\"lat\" class=\"gt_row gt_right\">-736015.3</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nTo get a sense of our data, we can take a random sample from our training data and plot it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_sample <- dialects_train %>% sample_n(1000)\n\nggplot(data = dialects_sample) +\n  geom_sf(data = us) +\n  geom_point(aes(x = lon, y = lat, color = dialect), alpha = 1) +\n  scale_color_brewer(palette = \"Dark2\",  name = \"Dialect\")\n```\n\n::: {.cell-output-display}\n![](geospacial-mapping_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n## KNN classification\n\n### Case study: Allegheny and Philadelphia counties\n\nThe implementation of the knn classifier is a little different from earlier classification problems, so let's walk through the basic idea with a quick example. First, let's subset out the data for 2 counties: Allegheny and Philadelphia counties (identified by their FIPS codes).\n\nThen, we'll construct a simple data frame with 3 columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_penn <- point_data[grepl(\"42003|42101\", point_data$fips), ]\n\ndialects_penn <- data.frame(dialect = dialects_penn$var, \n                            lon = st_coordinates(dialects_penn)[, 1], \n                            lat = st_coordinates(dialects_penn)[, 2]) %>%\n mutate(dialect = as.factor(dialect))\n```\n:::\n\n\nFrom that, we can split the data into a training and test set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\nvalid_split <- rsample::initial_split(dialects_penn, .75)\n\npenn_train <- rsample::analysis(valid_split)\npenn_test <- rsample::assessment(valid_split)\n```\n:::\n\n\nFor more conventional classification tasks, we would want to determine the optimal k for our model using the `train.kknn()` function:\n\n<https://rpubs.com/bonibruno/svm-knn>\n\nFor our purposes, we'll use a quick rule of thumb and use the square-root of our *n* observations. Now we can call a model in which we try to predict the dialect variant (*soda*, *pop*, *coke*, *other*) based on geolocation.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknn_penn <- kknn::kknn(dialect ~ ., \n                       train = penn_train, \n                       test = penn_test, \n                       kernel = \"gaussian\", \n                       k = 61)\n```\n:::\n\n\nFor conventional classification tasks, we would be interested in our confusion matrix, and our model's accuracy\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntab <- table(knn_penn$fitted.values, penn_test$dialect)\n\naccuracy <- function(x){sum(diag(x)/(sum(rowSums(x)))) * 100}\n\naccuracy(tab)|>\n  data.frame() |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ytnoepajox\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ytnoepajox table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ytnoepajox thead, #ytnoepajox tbody, #ytnoepajox tfoot, #ytnoepajox tr, #ytnoepajox td, #ytnoepajox th {\n  border-style: none;\n}\n\n#ytnoepajox p {\n  margin: 0;\n  padding: 0;\n}\n\n#ytnoepajox .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ytnoepajox .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ytnoepajox .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ytnoepajox .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ytnoepajox .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ytnoepajox .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ytnoepajox .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ytnoepajox .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ytnoepajox .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ytnoepajox .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ytnoepajox .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ytnoepajox .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ytnoepajox .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ytnoepajox .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ytnoepajox .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytnoepajox .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ytnoepajox .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ytnoepajox .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ytnoepajox .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytnoepajox .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ytnoepajox .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytnoepajox .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ytnoepajox .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytnoepajox .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ytnoepajox .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytnoepajox .gt_left {\n  text-align: left;\n}\n\n#ytnoepajox .gt_center {\n  text-align: center;\n}\n\n#ytnoepajox .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ytnoepajox .gt_font_normal {\n  font-weight: normal;\n}\n\n#ytnoepajox .gt_font_bold {\n  font-weight: bold;\n}\n\n#ytnoepajox .gt_font_italic {\n  font-style: italic;\n}\n\n#ytnoepajox .gt_super {\n  font-size: 65%;\n}\n\n#ytnoepajox .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ytnoepajox .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ytnoepajox .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ytnoepajox .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ytnoepajox .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ytnoepajox .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ytnoepajox .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ytnoepajox .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ytnoepajox div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"accuracy.tab.\">accuracy.tab.</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"accuracy.tab.\" class=\"gt_row gt_right\">88.16327</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nFor our purposes, we're interested in the probabilities of each variant being preferred based on location. Allegheny county is at the top of our table, with a very strong preference for *pop*.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nknn_penn$prob |>\n  head(1) |>\n  data.frame() |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"suudouriua\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#suudouriua table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#suudouriua thead, #suudouriua tbody, #suudouriua tfoot, #suudouriua tr, #suudouriua td, #suudouriua th {\n  border-style: none;\n}\n\n#suudouriua p {\n  margin: 0;\n  padding: 0;\n}\n\n#suudouriua .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#suudouriua .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#suudouriua .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#suudouriua .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#suudouriua .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#suudouriua .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#suudouriua .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#suudouriua .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#suudouriua .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#suudouriua .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#suudouriua .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#suudouriua .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#suudouriua .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#suudouriua .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#suudouriua .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#suudouriua .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#suudouriua .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#suudouriua .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#suudouriua .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#suudouriua .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#suudouriua .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#suudouriua .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#suudouriua .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#suudouriua .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#suudouriua .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#suudouriua .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#suudouriua .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#suudouriua .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#suudouriua .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#suudouriua .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#suudouriua .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#suudouriua .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#suudouriua .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#suudouriua .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#suudouriua .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#suudouriua .gt_left {\n  text-align: left;\n}\n\n#suudouriua .gt_center {\n  text-align: center;\n}\n\n#suudouriua .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#suudouriua .gt_font_normal {\n  font-weight: normal;\n}\n\n#suudouriua .gt_font_bold {\n  font-weight: bold;\n}\n\n#suudouriua .gt_font_italic {\n  font-style: italic;\n}\n\n#suudouriua .gt_super {\n  font-size: 65%;\n}\n\n#suudouriua .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#suudouriua .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#suudouriua .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#suudouriua .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#suudouriua .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#suudouriua .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#suudouriua .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#suudouriua .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#suudouriua div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"COKE\">COKE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"OTHER\">OTHER</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"POP\">POP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SODA\">SODA</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"COKE\" class=\"gt_row gt_right\">0</td>\n<td headers=\"OTHER\" class=\"gt_row gt_right\">0</td>\n<td headers=\"POP\" class=\"gt_row gt_right\">0.9672131</td>\n<td headers=\"SODA\" class=\"gt_row gt_right\">0.03278689</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nAnd Philadelphia county is at the bottom of our table with a strong preference for *soda*.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nknn_penn$prob |>\n  tail(1) |>\n  data.frame() |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ahuqcrxsve\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ahuqcrxsve table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ahuqcrxsve thead, #ahuqcrxsve tbody, #ahuqcrxsve tfoot, #ahuqcrxsve tr, #ahuqcrxsve td, #ahuqcrxsve th {\n  border-style: none;\n}\n\n#ahuqcrxsve p {\n  margin: 0;\n  padding: 0;\n}\n\n#ahuqcrxsve .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ahuqcrxsve .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ahuqcrxsve .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ahuqcrxsve .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ahuqcrxsve .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ahuqcrxsve .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ahuqcrxsve .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ahuqcrxsve .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ahuqcrxsve .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ahuqcrxsve .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ahuqcrxsve .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ahuqcrxsve .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ahuqcrxsve .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ahuqcrxsve .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ahuqcrxsve .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ahuqcrxsve .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ahuqcrxsve .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ahuqcrxsve .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ahuqcrxsve .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ahuqcrxsve .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ahuqcrxsve .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ahuqcrxsve .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ahuqcrxsve .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ahuqcrxsve .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ahuqcrxsve .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ahuqcrxsve .gt_left {\n  text-align: left;\n}\n\n#ahuqcrxsve .gt_center {\n  text-align: center;\n}\n\n#ahuqcrxsve .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ahuqcrxsve .gt_font_normal {\n  font-weight: normal;\n}\n\n#ahuqcrxsve .gt_font_bold {\n  font-weight: bold;\n}\n\n#ahuqcrxsve .gt_font_italic {\n  font-style: italic;\n}\n\n#ahuqcrxsve .gt_super {\n  font-size: 65%;\n}\n\n#ahuqcrxsve .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ahuqcrxsve .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ahuqcrxsve .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ahuqcrxsve .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ahuqcrxsve .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ahuqcrxsve .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ahuqcrxsve .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#ahuqcrxsve .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#ahuqcrxsve div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"COKE\">COKE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"OTHER\">OTHER</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"POP\">POP</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"SODA\">SODA</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"COKE\" class=\"gt_row gt_right\">0</td>\n<td headers=\"OTHER\" class=\"gt_row gt_right\">0.03278689</td>\n<td headers=\"POP\" class=\"gt_row gt_right\">0.04918033</td>\n<td headers=\"SODA\" class=\"gt_row gt_right\">0.9180328</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n### Spatial interpolation\n\nThose probabilities can be used to select both color (for the most probable variant) and the alpha of the color (based on the value of the probability).\n\nSounds easy enough, but we don't have values for the entire map. We need to use our known values to estimate those at other unknown points. This is process called spatial interpolation:\n\n<https://docs.qgis.org/2.18/en/docs/gentle_gis_introduction/spatial_analysis_interpolation.html>\n\nWhat follows in wholely indebted to Timo Grossenbacher.\n\n<https://timogrossenbacher.ch/2018/03/categorical-spatial-interpolation-with-r/>\n\nEssentially, we need to configure an empty grid and interpolate that grid with our point data. Another complication is that this process is quite memory and computationally intensive. So we're ultimately going to split up that grid into batches.\n\nWe'll begin setting up our grid by specifying its width in pixels.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwidth_in_pixels <- 300\n```\n:::\n\n\nThe width of a grid cell is calculated from the dimensions of our US map and is defined as dx.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndx <- ceiling( (st_bbox(us)[\"xmax\"] - st_bbox(us)[\"xmin\"]) / width_in_pixels)\n```\n:::\n\n\nThe height of a grid cell is the same because we'll use quadratic grid cells, **dx == dy**.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndy <- dx\n```\n:::\n\n\nCalculate the height in pixels of the resulting grid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nheight_in_pixels <- floor( (st_bbox(us)[\"ymax\"] - st_bbox(us)[\"ymin\"]) / dy)\n```\n:::\n\n\nAnd finally construct the grid with the **st_make_grid()** function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrid <- st_make_grid(us, cellsize = dx, n = c(width_in_pixels, height_in_pixels), what = \"centers\")\n```\n:::\n\n\nNext, we'll set our k at 1000. This will result is a smoother looking map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nk <- 1000\n```\n:::\n\n\nNow, we can define a `compute_grid()` function that returns the probability of the most likely variant.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompute_grid <- function(grid, dialects_train, knn) {\n  # create empty result data frame\n  dialects_result <- data.frame(dialect = as.factor(NA), \n                                lon = st_coordinates(grid)[, 1], \n                                lat = st_coordinates(grid)[, 2])\n  # run KKNN\n  dialects_kknn <- kknn::kknn(dialect ~ ., \n                              train = dialects_train, \n                              test = dialects_result, \n                              kernel = \"gaussian\", \n                              k = knn)\n  # bring back to result data frame\n  # only retain the probability of the dominant dialect at that grid cell\n  dialects_result <- dialects_result %>%\n    # extract the interpolated dialect at each grid cell with the \n    # kknn::fitted() function\n    mutate(dialect = fitted(dialects_kknn),\n           # only retain the probability of the interpolated dialect,\n           # discard the others\n           prob = apply(dialects_kknn$prob, 1, function(x) max(x)))\n  \n  return(dialects_result)\n}\n```\n:::\n\n\nWe can set the parameters for parallel and batch processing. Adjust cores and batch size accordingly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregisterDoParallel(cores = 4) # if you have more processing power you can up this number\n\n# Specify number of batches and resulting size of each batch (in grid cells).\nno_batches <- 60 # increase this number if you run into memory problems\nbatch_size <- ceiling(length(grid) / no_batches)\n```\n:::\n\n\nFinally, we'll generate our result using parallel processing. This will take at least a couple of minutes.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_result <- foreach(.packages = c(\"sf\", \"tidyverse\"),\n  batch_no = 1:no_batches, \n  # after each grid section is computed, rbind the resulting df into one big dialects_result df\n  .combine = rbind, \n  # the order of grid computation doesn't matter: this speeds it up even more\n  .inorder = FALSE) %dopar% {\n    # compute indices for each grid section, depending on batch_size and current batch\n    start_idx <- (batch_no - 1) * batch_size + 1\n    end_idx <- batch_no * batch_size\n    # specify which section of the grid to interpolate, using regular subsetting\n    grid_batch <- grid[start_idx:ifelse(end_idx > length(grid), \n                                        length(grid),\n                                        end_idx)]\n    # apply the actual computation to each grid section\n    df <- compute_grid(grid_batch, dialects_train, k)\n  }\n```\n:::\n\n\nWe'll now convert the result into an **sf** object for mapping.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_raster <- st_as_sf(dialects_result, \n                            coords = c(\"lon\", \"lat\"),\n                            crs = nalcc,\n                            remove = F)\n```\n:::\n\n\nRemember that we've calculated a rectangular grid. As a last step, we can use the outline of the US to mask the borders of our map.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndialects_raster <- dialects_raster[us, ]\n```\n:::\n\n\nAnd plot the result... (Note that we're dropping *other*.)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = dialects_raster %>% filter(dialect != \"OTHER\")) +\n  geom_raster(aes(x = lon, y = lat, fill = dialect, alpha = prob)) +\n  scale_fill_manual(values = c(\"forestgreen\", \"steelblue\", \"tomato\")) +\n  scale_alpha(guide = 'none') +\n  geom_sf(data = us, alpha = 0, size = 0.25) +\n  theme_void() +\n  theme(legend.position = c(0.1, 0.2), legend.box = \"horizontal\") +\n  theme(legend.title=element_blank())\n```\n\n::: {.cell-output-display}\n![](geospacial-mapping_files/figure-html/unnamed-chunk-36-1.png){width=672}\n:::\n:::\n\n\nHow does our result compare to Katz's?\n\n<https://www.foodrepublic.com/2013/07/29/a-final-word-on-the-soda-vs-pop-vs-coke-nomenclature-debate/>\n\n",
    "supporting": [
      "geospacial-mapping_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}