{"title":"Texts, Algorithms, and Black-Boxes","markdown":{"headingText":"Texts, Algorithms, and Black-Boxes","containsRefs":false,"markdown":"\n\nWe're going to start by unpacking the controversy regarding the **syuzhet** R package. (The readings are short and posted on Canvas, if you haven't looked at them already.) This is a useful exercise, I think, because it gets to some foundational issues in text analysis--you're going to encounter them in your work so they're worth considering from the beginning.\n\n## Load packages and data\n\nLoad the package that we'll use in this short lab.\n\n```{r}\n#| message: false\n#| error: false\n#| warning: false\n\nlibrary(gt)\nlibrary(syuzhet)\nlibrary(tidyverse)\n```\n\nLoad data from file:\n\n```{r}\nload(\"../data/sentiment_data.rda\")\n```\n\nThe novels that Jockers uses as examples are included as data, which can be accessed as **sentiment_data**. There are 4 novels, and we'll check their names stored in the **doc_id** column.\n\nFor this demonstration, we'll be using *Madame Bovary*.\n\n```{r}\n#| echo: false\n#| tbl-cap: \"A small corpus included in the cmu.textstat package.\"\n\nsentiment_data |> \n  select(doc_id) |>\n  head(10) |> \n  gt()\n```\n\n## Prep the data and calculate sentiment\n\nNext, we do some simple cleaning using **str_squish** from the **stringr** package. Then we'll split the the novel into sentences and calculate a sentiment score for each.\n\n```{r}\n\n# str_squish() is a useful function from readr for getting rid of extra spaces, carriage returns, etc.\nmb <- str_squish(sentiment_data$text[1])\n\n# chunk the novel into sentences\nmb_sentences <- get_sentences(mb)\n\n# calculate and return sentiment scores\nmb_sentiment <- get_sentiment(mb_sentences)\n```\n\nLet's check the data:\n\n```{r}\n#| echo: false\n#| tbl-cap: \"Sample sentiment scores.\"\n\nmb_sentiment |>\n  data.frame() |>\n  head(10) |>\n  gt()\n```\n\n## Transforming the data\n\nThe next step is to transform the data. Originally, Jockers used a Fourier transformation, which he described as follows:\n\n> Aaron introduced me to a mathematical formula from signal processing called the Fourier transformation. The Fourier transformation provides a way of decomposing a time based signal and reconstituting it in the frequency domain. A complex signal (such as the one seen above in the first figure in this post) can be decomposed into series of symmetrical waves of varying frequencies. And one of the magical things about the Fourier equation is that these decomposed component sine waves can be added back together (summed) in order to reproduce the original wave formâ€“this is called a backward or reverse transformation. Fourier provides a way of transforming the sentiment-based plot trajectories into an equivalent data form that is independent of the length of the trajectory from beginning to end. The frequency domain begins to solve the book length problem.\n\nThis introduced some unwanted outcomes, namely that the resulting wave-forms must begin and end at the same point. The updated function uses a Discrete Cosine Transform (DCT), which is commonly used in data compression.\n\n```{r}\n\nmb_dct <- get_dct_transform(mb_sentiment, low_pass_size = 5, x_reverse_len = 100, scale_vals = FALSE, scale_range = TRUE)\n\nmb_dct <- data.frame(dct = mb_dct) %>%\n  rownames_to_column(\"time\") %>%\n  mutate(time = as.numeric(time))\n```\n\nCheck the data:\n\n```{r}\n#| echo: false\n#| tbl-cap: \"Sample transformed scores.\"\n\nmb_dct |>\n  head(10) |>\n  gt()\n```\n\nFinally, the values can be plotted.\n\n```{r}\n#| fig-cap: \"Sentiment in \\\\textit{Madame Bovary} using transformed values.\"\n\nplot(mb_dct, type =\"l\", xlab = \"Narrative Time\", ylab = \"Emotional Valence\", col = \"red\")\n```\n\n## Transformed vs. non-transformed data\n\nIn order to better compare the before vs. after, let's create a data frame in which we normalize the narrative time values and scale the sentiment scores.\n\n```{r}\nmb_df <- mb_sentiment %>% \n  data.frame(sentiment = .) %>%\n  rownames_to_column(\"time\") %>%\n  mutate(time = as.numeric(time)) %>%\n  mutate(time = time/length(mb_sentiment)*100) %>%\n  mutate(sentiment = 2 * (sentiment - min(sentiment))/( max(sentiment) - min(sentiment)) -1)\n\n```\n\nNow, those values can be plotted with the values extracted from DCT.\n\n```{r}\n#| fig-height: 3.5\n#| fig-width: 7\n#| fig-cap: \"Transformed vs. non-transformed sentiment in *Madame Bovary*\"\n\nggplot(data=mb_dct, aes(x=time, y=dct)) +\n  geom_line(colour= \"tomato\") +\n  geom_point(data=mb_df, aes(x=time, y=sentiment), alpha=0.25, size=.25) +\n  xlab(\"Normalized Narrative Time\") + ylab(\"Scaled Sentiment\") +\n  theme_minimal()\n```\n\n::: callout-important\n## Pause for Lab Set Question\n\nComplete [Task 1 in Lab Set 4](../lab_sets/LabSet_04.qmd#sentiment-analysis).\n:::\n\n\n\n","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","output-file":"sentiment-and-syuzhet.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.549","editor":"source"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":[]}